---
// @ts-nocheck
// Blog listing page
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

// Get all posts, sorted by date (newest first)
const allPosts = await getCollection("posts");
const sortedPosts = allPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout
  title="Blog · Lystaria"
  description="Musings on magic, growth, and the space between the mystical and mundane."
  type="website"
>
  <div class="container-wide">
    <header class="blog-header">
      <h1>The Grimoire</h1>
      <p class="blog-intro">
        This grimoire is a living record of practice, reflection, and inquiry.
        Here, magic is approached as a language--one learned through symbolism,
        cycles, intention, and lived experience. These writings explore
        spellcraft, divination, astrology, and personal transformation not as
        spectacle, but as tools for meaning-making in an ever-changing world.
      </p>

      <div class="blog-note">
        <h2>Transparency</h2>
        <p>
          As part of my creative and editing process, I sometimes use AI tools to
          collaborate on refining my writing. These tools help with flow, clarity,
          and structure, but the content itself always comes from my own thoughts,
          experiences, and perspective. Posts created with this kind of support
          will be clearly labeled. Transparency matters to me, and I want readers
          to feel informed and respected here.
        </p>
      </div>
    </header>

    <div class="posts-grid">
      {sortedPosts.map((post) => {
        const formattedDate = new Date(post.data.pubDate).toLocaleDateString(
          "en-US",
          { year: "numeric", month: "long", day: "numeric" }
        );

        return (
          <article class="post-card">
            {post.data.coverImage && (
              <div class="post-media">
                <img
                  src={post.data.coverImage}
                  alt=""
                  loading="lazy"
                  class="post-cover"
                />
              </div>
            )}

            {/* ✅ NEW: wrapper that includes BOTH the link area and the tags
                so the overlay can cover the entire bottom area */}
            <div class="post-lower">
              {/* ✅ REAL LINK: whole body is clickable (title + read more included) */}
              <a class="post-link" href={`/blog/${post.slug}`}>
                <div class="post-content">
                  <div class="post-header">
                    <h2>{post.data.title}</h2>
                    <time
                      class="post-date"
                      datetime={post.data.pubDate.toISOString()}
                    >
                      {formattedDate}
                    </time>
                  </div>

                  <p class="post-description">{post.data.description}</p>

                  <div class="read-more">Read more →</div>
                </div>
              </a>

              {/* ✅ Tags are still outside the big link, independently clickable */}
              {post.data.tags && post.data.tags.length > 0 && (
                <div class="post-tags">
                  {post.data.tags.map((tag) => (
                    <a href={`/blog/tag/${tag}`} class="tag">
                      {tag}
                    </a>
                  ))}
                </div>
              )}
            </div>
          </article>
        );
      })}
    </div>
  </div>

  <style>
    .blog-header {
      text-align: center;
      padding: 3rem 0 4rem;
      border-bottom: 1px solid var(--color-border);
      margin-bottom: 4rem;
    }

    .blog-header h1 {
      font-size: 3rem;
      margin-bottom: 1rem;
    } 

    .blog-intro {
      font-size: 0.9rem;
      color: var(--color-text-muted);
      max-width: 700px;
      margin: 0 auto;
    }

    .blog-note {
      max-width: 700px;
      margin: 3rem auto 0;
      padding: 2rem;
      border: 2px dotted transparent;
      border-image: var(--gradient-accent) 1;
      border-radius: 12px;
       font-size: 0.75rem;
       color: #ffffff;
       /* line-height: 1.8; */
    }

   .blog-note h2 {
      text-align: center;
      margin: 0 0 1rem;
      font-size: 2rem;
      line-height: 1.2;
   }

    /* MOBILE EXPERIENCE */
    @media (max-width: 768px) {
      .container-wide {
        padding: 0 1rem;
      }

      .blog-header {
        padding: 2rem 0 2.5rem;
        margin-bottom: 2.5rem;
      }
      
      .blog-note h3 { 
        font-size: 1.5rem;
        margin-top: 1.5rem;
      }
    }
  </style>
</BaseLayout>