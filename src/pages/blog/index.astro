---
// @ts-nocheck
// Blog listing page
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import GradientDivider from "../components/GradientDivider.astro";

// Get all posts, sorted by date (newest first)
const allPosts = await getCollection("posts");
const sortedPosts = allPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout
  title="Blog · Lystaria"
  description="Musings on magic, growth, and the space between the mystical and mundane."
  type="website"
>
  <section class="blog-hero">
    <header class="blog-header">
      <h1>The Grimoire</h1>
      <p class="blog-intro">
        This grimoire is a living record of practice and reflection, where magic is treated as a language shaped by symbolism, cycles, intention, and lived experience. It explores spellcraft, divination, astrology, and transformation as tools for meaning in an ever-changing world.
      </p>
    </header>
  </section>
  
  <GradientDivider />

  <section class="blog-transparency">
    <div class="blog-note">
      <h2>Transparency</h2>
      <p>
        As part of my creative and editing process, I sometimes use AI tools to collaborate on refining my writing. These tools help with flow, clarity, and structure, but the content itself always comes from my own thoughts, experiences, and perspective. Posts created with this kind of support will be clearly labeled. Transparency matters to me, and I want readers to feel informed and respected here.
      </p>
    </div>
  </section>

  <section class="blog-posts">
    <div class="posts-grid">
      {sortedPosts.map((post) => {
        const formattedDate = new Date(post.data.pubDate).toLocaleDateString(
          "en-US",
          { year: "numeric", month: "long", day: "numeric" }
        );

        return (
          <div class="post-card">
            {post.data.coverImage && (
              <div class="post-media">
                <img
                  src={post.data.coverImage}
                  alt=""
                  loading="lazy"
                  class="post-cover"
                />
              </div>
            )}

            <div class="post-lower">
              <a class="post-link" href={`/blog/${post.slug}`}>
                <div class="post-content">
                  <div class="post-header">
                    <h2>{post.data.title}</h2>
                    <time
                      class="post-date"
                      datetime={post.data.pubDate.toISOString()}
                    >
                      {formattedDate}
                    </time>
                  </div>

                  <p class="post-description">{post.data.description}</p>

                  <div class="read-more">Read more →</div>
                </div>
              </a>

              {post.data.tags && post.data.tags.length > 0 && (
                <div class="post-tags">
                  {post.data.tags.map((tag) => (
                    <a href={`/blog/tag/${tag}`} class="tag">
                      {tag}
                    </a>
                  ))}
                </div>
              )}
            </div>
          </div>
        );
      })}
    </div>
  </section>
</BaseLayout>

<style>
  .blog-hero,
  .blog-transparency,
  .blog-posts {
    width: 100%;
    margin: 0;
    padding: 0;
  }

  .blog-header h1 {
    font-size: 2.3rem;
  }

  .blog-note h2 {
    font-size: 2rem;
  }
  
  .blog-header {
  text-align: center;
  padding: 2rem 0 0.75rem; /* tighter bottom padding */
  border-bottom: none;
  margin: 0;               /* remove extra gap */
}

.blog-intro {
  max-width: 900px;
  margin: 0 auto;          /* keep it centered, no extra spacing */
}

/* Remove any extra spacing the wrapper section might introduce */
.blog-transparency {
  margin: 0;
  padding: 0;
}

/* Keep the box snug to the header */
.blog-note {
  text-align: center;
  max-width: 900px;

  margin: 0 auto 2rem;     /* top 0 = snug, bottom still 2rem */
  padding: 2rem;

  border: 2px dotted transparent;
  border-image: var(--gradient-accent) 1;
  border-radius: 8px;

  font-size: 0.75rem;
  color: #ffffff;
}

  /* MOBILE EXPERIENCE */
  @media (max-width: 1100px) {
    .blog-header {
      padding: 2rem 0 2.5rem;
      margin-bottom: 0;
    }
  }
</style>