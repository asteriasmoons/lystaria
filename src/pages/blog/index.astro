---
// @ts-nocheck
// Blog listing page
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

// Get all posts, sorted by date (newest first)
const allPosts = await getCollection("posts");
const sortedPosts = allPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout
  title="Blog · Lystaria"
  description="Musings on magic, growth, and the space between the mystical and mundane."
  type="website"
>
  <div class="container-wide">
    <header class="blog-header">
      <h1>The Grimoire</h1>
      <p class="blog-intro">
        This grimoire is a living record of practice, reflection, and inquiry.
        Here, magic is approached as a language—one learned through symbolism,
        cycles, intention, and lived experience. These writings explore
        spellcraft, divination, astrology, and personal transformation not as
        spectacle, but as tools for meaning-making in an ever-changing world.
      </p>

      <div class="blog-note">
      <h3>Transparency</h3>
      <p>
        As part of my creative and editing process, I sometimes use AI tools to
        collaborate on refining my writing. These tools help with flow, clarity,
        and structure, but the content itself always comes from my own thoughts,
        experiences, and perspective. Posts created with this kind of support
        will be clearly labeled. Transparency matters to me, and I want readers
        to feel informed and respected here.
      </p>
      </div>

    </header>

    <div class="posts-grid">
      {
        sortedPosts.map((post) => {
          const formattedDate = new Date(post.data.pubDate).toLocaleDateString(
            "en-US",
            {
              year: "numeric",
              month: "long",
              day: "numeric",
            }
          );

          return (
            <article class="post-card">
              <a href={`/blog/${post.slug}`} class="post-link">
                {post.data.coverImage && (
                  <div class="post-media">
                    <img
                      src={post.data.coverImage}
                      alt=""
                      loading="lazy"
                      class="post-cover"
                    />
                  </div>
                )}
                <div class="post-content">
                  <div class="post-header">
                    <h2>{post.data.title}</h2>
                    <time
                      class="post-date"
                      datetime={post.data.pubDate.toISOString()}
                    >
                      {formattedDate}
                    </time>
                  </div>

                  <p class="post-description">{post.data.description}</p>

                  <div class="read-more">Read more →</div>
                </div>
              </a>

              {post.data.tags && post.data.tags.length > 0 && (
                <div class="post-tags">
                  {post.data.tags.map((tag) => (
                    <a href={`/blog/tag/${tag}`} class="tag">
                      {tag}
                    </a>
                  ))}
                </div>
              )}
            </article>
          );
        })
      }
    </div>
  </div>

  <style>
    .container-wide {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 var(--page-pad);
    }

    .blog-header {
      text-align: center;
      padding: 3rem 0 4rem;
      border-bottom: 1px solid var(--color-border);
      margin-bottom: 4rem;
    }

    .blog-header h1 {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .blog-intro {
      font-size: 0.9rem;
      color: var(--color-text-muted);
      max-width: 700px;
      margin: 0 auto;
    }

    .blog-note {
      max-width: 700px;
      margin: 3rem auto 0; /* ← ADD THIS - creates space from blog-intro */
      padding: 2rem; /* ← ADD THIS - space inside the box */
      border: 2px dotted rgba(126, 126, 255, 0.4); /* ← ADD THIS - dotted border */
      border-radius: 12px; /* ← ADD THIS - rounded corners */
      font-size: 0.75rem; /* Keep your smaller font */
      color: var(--color-text-muted);
      line-height: 1.8;
    }

    .blog-note h3 {
      text-align: center;
      margin-bottom: 1rem;
      color: #ffffff;
      font-size: 1.8rem;
    }

    .posts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 2rem;
      padding-bottom: 4rem;
    }

     .post-card {
      background: linear-gradient(
       135deg,
       #9a2dfe 10%,
       #9a2dfe 25%,
       #ffff5e 45%,
       #e019d4 65%,
       #00dbff 100%
     );
      border: 1px solid var(--color-border);
      border-radius: 12px;
      padding: 0; /* KEY: remove outer padding */
      transition: all 0.2s;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .post-link {
      display: flex;
      flex-direction: column;
      flex-grow: 1;
      color: inherit;
      text-decoration: none;
    }

    /* NEW: optional cover slot */
    .post-media {
      position: relative;
      width: 100%;
      aspect-ratio: 2 / 1; /* PERFECT for 1280 × 640 */
      overflow: hidden;
      flex-shrink: 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }

    /* subtle overlay so covers blend with your theme */
    .post-media::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: linear-gradient(
        135deg,
        rgba(126, 126, 255, 0.14),
        rgba(90, 200, 250, 0.1),
        rgba(10, 10, 15, 0.22)
      );
    }

    .post-cover {
      width: 100%;
      height: 100%;
      object-fit: cover; /* crops gently, not aggressively */
      object-position: center; /* safe default */
      display: block;
      opacity: 0.95;
      transition:
        transform 0.35s ease,
        opacity 0.35s ease;
    }

    .post-card:hover .post-cover {
      transform: scale(1.03);
      opacity: 1;
    }

    .post-content {
      display: flex;
      flex-direction: column;
      flex-grow: 1;
      padding: var(--card-pad); /* KEY: single source of padding */
      gap: var(--stack-gap); /* KEY: consistent spacing */
    }

    .post-header {
      margin-bottom: 0; /* spacing handled by gap now */
    }

    .post-card h2 {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
      line-height: 1.3;

      background: none !important;
      -webkit-background-clip: initial !important;
      background-clip: initial !important;

      -webkit-text-fill-color: #ffffff !important;
      color: #ffffff !important;

      display: block !important;
    }

    .post-date {
      display: block;
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
      font-style: italic;
    }

    .post-description {
      margin-bottom: 0; /* spacing handled by gap now */
      flex-grow: 1;
    }

    .post-tags {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      padding: 0 var(--card-pad) var(--card-pad) var(--card-pad); /* matches content */
    }

    .tag {
      background-color: var(--color-bg);
      color: var(--color-accent);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.85rem;
      border: 1px solid var(--color-border);
      text-decoration: none;
      transition: all 0.3s ease;
    }

    .tag:hover {
      background-color: var(--color-accent);
      color: var(--color-bg);
      transform: translateY(-2px);
    }

    .post-card:hover .tag {
      border-color: var(--color-accent);
    }

    .read-more {
      display: inline-block;
      align-self: flex-start;

      margin-top: auto;
      padding: 0.35rem 0.9rem;

      font-size: 0.85rem;
      font-weight: 500;
      letter-spacing: 0.02em;

      color: #ffffff;
      background: rgba(10, 10, 15, 0.75);
      border: 1px solid var(--color-border);
      border-radius: 999px;

      text-decoration: none;
      transition: all 0.25s ease;
    }

    .post-card:hover .read-more {
      border-color: var(--color-accent);
      background: rgba(10, 10, 15, 0.9);
      transform: translateY(-1px);
    }

    .post-card:hover .read-more {
      color: rgba(255, 255, 255, 0.7);
    }

    /* MOBILE EXPERIENCE */
    @media (max-width: 768px) {
      .blog-header h1 {
        font-size: 2rem;
      }

      .container-wide {
        padding: 0 1rem;
      }

      .blog-header {
        padding: 2rem 0 2.5rem;
        margin-bottom: 2.5rem;
      }

      .posts-grid {
        gap: 1.25rem;
        padding-bottom: 2.5rem;
      }

      .post-media {
        aspect-ratio: 2.5 / 1; /* subtly tighter on phones */
      }

      .post-cover {
        object-position: center 30%;
      }

      .tag {
        padding: 0.2rem 0.6rem;
        font-size: 0.8rem;
      }
    }
  </style>
</BaseLayout>
