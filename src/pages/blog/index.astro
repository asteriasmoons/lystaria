---
// @ts-nocheck
// Blog listing page
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import GradientDivider from "../../components/GradientDivider.astro";

// Get all posts, sorted by date (newest first)
const allPosts = await getCollection("posts");
const sortedPosts = allPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout
  title="Blog · Lystaria"
  description="Musings on magic, growth, and the space between the mystical and mundane."
  type="website"
>
  <section class="blog-hero">
    <header class="blog-header">
      <h1>The Grimoire</h1>
      <p class="blog-intro">
        This grimoire is a living record of practice and reflection, where magic is treated as a language shaped by symbolism, cycles, intention, and lived experience. It explores spellcraft, divination, astrology, and transformation as tools for meaning in an ever-changing world.
      </p>
    </header>
  </section>
  
  <GradientDivider />

  <section class="blog-transparency">
    <div class="blog-note">
      <h2>Transparency</h2>
      <p>
        As part of my creative and editing process, I sometimes use AI tools to collaborate on refining my writing. These tools help with flow, clarity, and structure, but the content itself always comes from my own thoughts, experiences, and perspective. Posts created with this kind of support will be clearly labeled. Transparency matters to me, and I want readers to feel informed and respected here.
      </p>
    </div>
  </section>

  <section class="blog-posts">
    <div class="posts-grid">
      {sortedPosts.map((post) => {
        const formattedDate = new Date(post.data.pubDate).toLocaleDateString(
          "en-US",
          { year: "numeric", month: "long", day: "numeric" }
        );

        return (
          <div class="post-card">
            {post.data.coverImage && (
              <div class="post-media">
                <img
                  src={post.data.coverImage}
                  alt=""
                  loading="lazy"
                  class="post-cover"
                />
              </div>
            )}

            <div class="post-lower">
              <a class="post-link" href={`/blog/${post.slug}`}>
                <div class="post-content">
                  <div class="post-header">
                    <h2>{post.data.title}</h2>
                    <time
                      class="post-date"
                      datetime={post.data.pubDate.toISOString()}
                    >
                      {formattedDate}
                    </time>
                  </div>

                  <p class="post-description">{post.data.description}</p>

                  <div class="read-more">Read more →</div>
                </div>
              </a>

              {post.data.tags && post.data.tags.length > 0 && (
                <div class="post-tags">
                  {post.data.tags.map((tag) => (
                    <a href={`/blog/tag/${tag}`} class="tag">
                      {tag}
                    </a>
                  ))}
                </div>
              )}
            </div>
          </div>
        );
      })}
    </div>
  </section>
</BaseLayout>

<style>
  /* ====================================
     HERO SECTION
     ==================================== */
  .blog-hero {
    text-align: center;
    margin-bottom: 1.5rem;
  }

  /* Subtitle under the main heading */
  .blog-header {
    font-size: 0.85rem;
    line-height: 1.7;
    color: rgba(255, 255, 255, 0.909); /* Slightly dimmed white */
    max-width: 700px; /* Keep lines readable */
    margin: 0 auto; /* Center it */
  }

  /* ====================================
     BLOG INTRO SECTION
     ==================================== */
  .blog-transparency {
  margin-bottom: 1.25rem;
}
  
  .blog-intro {
    text-align: center;
  }

  .blog-note {
    text-align: center;
    max-width: 700px;
    margin: 0;
    padding: 2rem;
    border: 2px dotted transparent; /* Set to transparent */
    border-image: var(--gradient-accent) 1; /* Add this */
    border-radius: 8px; /* This won't work with border-image unfortunately */
    font-size: 0.85rem;
    color: #ffffff;
  }

  /* ====================================
     MOBILE CSS
     ==================================== */
  @media (max-width: 860px) {
    /* Smaller subtitle */
    .blog-intro {
      font-size: 0.95rem;
    }
  }
</style>
