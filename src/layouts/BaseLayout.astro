---
// BaseLayout.astro - The wrapper for all pages
import "../styles/global.css";

const {
  title = "Lystaria",
  description = "Where the mystical meets the mundane. A space for exploring magic, personal growth, mental wellness, and the philosophies that shape us.",
  image = "/banner.png",
  type = "website",
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);

const cookies = Astro.cookies;
const isAuthenticated = cookies.get("admin-auth")?.value === "true";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />

    <!-- Open Graph -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, Astro.site)} />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={new URL(image, Astro.site)} />

    <!-- Favicon & RSS -->
    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="mask-icon" href="/favicon.svg" color="#5AC8FA" />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="Lystaria RSS Feed"
      href="/rss.xml"
    />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Berkshire+Swash&family=Hachi+Maru+Pop&display=swap"
      rel="stylesheet"
    />

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-L7K4W4KG8M"
    ></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-L7K4W4KG8M");
    </script>

    <!-- Umami -->
    <script
      defer
      src="https://cloud.umami.is/script.js"
      data-website-id="0d899bcd-ac0f-4ef8-8ee7-f3988c9baaf6"></script>
  </head>

  <body>
    <header class="site-header">
      <div class="container">
        <nav class="nav">
          <a href="/" class="nav-logo" id="siteLogo">✦ Lystaria ✦</a>

          <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
            <img src="/icons/nav.svg" alt="Menu" class="menu-icon-img" />
          </button>

          <div class="nav-links" id="navLinks">
            <a href="/">Home</a>
            <a href="/blog">Blog</a>
            <a href="/horoscopes">Horoscopes</a>
            <a href="/chat">Discussions</a>
            <a href="/spellcrafting">Spellcrafting</a>
            <a href="/search">Search</a>
            <a href="/about">About</a>
            {
              isAuthenticated && (
                <a href="/admin" class="nav-admin">
                  Admin
                </a>
              )
            }
            <a href="#">Test Link 1</a>
            <a href="#">Test Link 2</a>
            <a href="#">Test Link 3</a>
            <a href="#">Test Link 4</a>
            <a href="#">Test Link 5</a>
            <a href="#">Test Link 6</a>
          </div>
        </nav>
      </div>
    </header>

    <main>
      <slot />
    </main>

    <footer class="site-footer">
      <div class="container">
        <p>© 2025 Lystaria · Crafted with moonlight and code</p>
        <div class="footer-links">
          <a href="/rss.xml" target="_blank" rel="noopener" class="rss-link">
            RSS Feed
          </a>
        </div>
      </div>
    </footer>

    <!-- TOAST CONTAINER -->
    <div id="toast" class="toast" aria-live="polite"></div>

    <style>
      /* Toast */
      .toast {
        position: fixed;
        left: 50%;
        bottom: 24px;
        transform: translateX(-50%) translateY(20px);
        opacity: 0;
        pointer-events: none;
        background: rgba(10, 10, 15, 0.78);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 12px;
        padding: 0.75rem 1rem;
        color: rgba(255, 255, 255, 0.9);
        font-size: 0.95rem;
        line-height: 1.35;
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.45);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
        transition:
          opacity 0.15s ease,
          transform 0.15s ease;
        z-index: 20000;
      }

      .toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    </style>

    <!-- TOAST SCRIPT -->
    <script is:inline>
      // @ts-nocheck
      window.showToast = function (message, ms = 1800) {
        const el = document.getElementById("toast");
        if (!el) return;
        el.textContent = String(message ?? "");
        el.classList.add("show");
        clearTimeout(el._toastTimer);
        el._toastTimer = setTimeout(() => {
          el.classList.remove("show");
        }, ms);
      };
    </script>

    <!-- EXISTING NAV JS -->
    <script>
      // @ts-nocheck 
      const menuToggle = document.getElementById("menuToggle");
      const navLinks = document.getElementById("navLinks");

      menuToggle?.addEventListener("click", () => {
        navLinks?.classList.toggle("active");
      });

      document.addEventListener("click", (e) => {
        const target = e.target;

        if (!(target instanceof Node)) return;

        if (!menuToggle?.contains(target) && !navLinks?.contains(target)) {
          navLinks?.classList.remove("active");
        }
      });

      navLinks?.querySelectorAll("a").forEach((link) => {
        link.addEventListener("click", () => {
          navLinks.classList.remove("active");
        });
      });
    </script>

    <script is:inline>
      document.addEventListener("DOMContentLoaded", function () {
        const logo = document.getElementById("siteLogo");
        if (logo) {
          logo.addEventListener("dblclick", function (e) {
            e.preventDefault();
            window.location.href = "/admin";
          });
        }
      });
    </script>
  </body>
</html>
